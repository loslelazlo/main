<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<style>
html,body,h1,h2,h3,h4,h5 {font-family: "Raleway", sans-serif}
</style>
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<div class="w3-container w3-center">  
  <div class="w3-container w3-center" id="chart_div"></div>
</div>  
<div class="w3-container w3-center"> 

<div class="w3-row">
      <div class="w3-col m1">&nbsp&nbsp
      </div>
      <div class="w3-col m1 w3-center w3-margin-left w3-margin-right">&nbsp&nbsp
      </div>


      <div class="w3-col m4 w3-center w3-red">ON-Off Sensor Change
      </div>


</div>

  
<div class="w3-row">

      <div class="w3-col m1">&nbsp&nbsp
      </div>

      <div class="w3-col m1 w3-center w3-margin-right w3-margin-left">
          <i class="fa fa-table" style="font-size:16px;  color:black"></i><label> Table</label>
          <select id="table" class="w3-select w3-show w3-border-right" name="option0" onchange="tableselect()">
           <option value="" disabled selected>  Select</option>
           <option value="0">New</option>
           <option value="1">SCH-1 Optimized</option>
           <option value="2">SCH-2 Normal</option>
           <option value="3">SCH-3 Dang</option>
          </select>
      </div>

      <div class="w3-col m1 w3-center w3-margin-right w3-margin-left">
          <i class="fa fa-clock-o" style="font-size:16px;  color:black"></i><label> Hour</label>
          <select disabled id="hours" class="w3-select w3-show w3-border-right" name="option1" onchange="mm()">
           <option value="" disabled selected>  Select</option>
           <option value="0">0</option>
           <option value="1">1</option>
           <option value="2">2</option>
           <option value="3">3</option>
           <option value="4">4</option>
           <option value="5">5</option>
           <option value="6">6</option>
           <option value="7">7</option> 
           <option value="8">8</option>
           <option value="9">9</option>
           <option value="10">10</option>
           <option value="11">11</option> 
           <option value="12">12</option>
           <option value="13">13</option>
           <option value="14">14</option>
           <option value="15">15</option> 
           <option value="16">16</option>
           <option value="17">17</option>
           <option value="18">18</option>
           <option value="19">19</option> 
           <option value="20">20</option>
           <option value="21">21</option>
           <option value="22">22</option>
           <option value="23">23</option> 
           
          </select>
      </div>


      <div class="w3-col m1 w3-center w3-margin-right w3-margin-left">
          <i class="fa fa-clock-o" style="font-size:16px;  color:black"></i><label> Minutes</label>
          <select disabled id="minutes" class="w3-select w3-show w3-border-right" name="option2" onchange="mm()">
           <option value="" disabled selected>  Select</option>
           <option value="0">0</option>
           <option value="1">1</option>
           <option value="2">2</option>
           <option value="3">3</option>
           <option value="4">4</option>
           <option value="5">5</option>
           <option value="6">6</option>
           <option value="7">7</option> 
           <option value="8">8</option>
           <option value="9">9</option>
           <option value="10">10</option>
           <option value="11">11</option> 
           <option value="12">12</option>
           <option value="13">13</option>
           <option value="14">14</option>
           <option value="15">15</option> 
           <option value="16">16</option>
           <option value="17">17</option>
           <option value="18">18</option>
           <option value="19">19</option> 
           <option value="20">20</option>
           <option value="21">21</option>
           <option value="22">22</option>
           <option value="23">23</option> 
           <option value="24">24</option>
           <option value="25">25</option>
           <option value="26">26</option>
           <option value="27">27</option> 
           <option value="28">28</option>
           <option value="29">29</option>
           <option value="30">30</option>
           <option value="31">31</option> 
           <option value="32">32</option>
           <option value="33">33</option>
           <option value="34">34</option>
           <option value="35">35</option> 
           <option value="36">36</option>
           <option value="37">37</option>
           <option value="38">38</option>
           <option value="39">39</option> 
           <option value="40">40</option>
           <option value="41">41</option>
           <option value="42">42</option>
           <option value="43">43</option>
           <option value="44">44</option>
           <option value="45">45</option>
           <option value="46">46</option>
           <option value="47">47</option> 
           <option value="48">48</option>
           <option value="49">49</option>
           <option value="50">50</option>
           <option value="51">51</option>
           <option value="52">52</option>
           <option value="53">53</option>
           <option value="54">54</option>
           <option value="55">55</option>
           <option value="56">56</option>
           <option value="57">57</option> 
           <option value="58">58</option>
           <option value="59">59</option>
         
          </select>
      </div>

      <div class="w3-col m1 w3-center w3-margin-right w3-margin-left">
          <i class="fa fa-lightbulb-o" style="font-size:16px;  color:black"></i><label> Power</label>
          <select disabled id="power" class="w3-select w3-show w3-border-right" name="option1" onchange="mm()">
           <option value="" disabled selected>  Select</option>
           <option value="0">OFF</option>
           <option value="10">10%</option>
           <option value="20">20%</option>
           <option value="30">30%</option>
           <option value="40">40</option>
           <option value="50">50%</option>
           <option value="60">60%</option>
           <option value="70">70%</option>
           <option value="80">80%</option>
           <option value="90">90%</option>
           <option value="100">100%</option>          
          </select>
      </div>



      <div class="w3-col m1 w3-center w3-margin-right">
           <div class="w3-margin-left w3-container w3-center w3-margin-top">
               <button disabled id="addPoint" class="w3-button w3-black w3-text-white" style="float: center;" onclick="addPoint();">Add Point
           </div>  
      </div>

      <div class="w3-col m1 w3-center w3-margin-right">
           <div class="w3-margin-left w3-container w3-center w3-margin-top">
               <button disabled id="saveTable" class="w3-button w3-black w3-text-white" style="float: center;" onclick="saveTable();">Save Table
           </div>  
      </div>

      <div class="w3-col m1 w3-center w3-margin-right">
           <div class="w3-margin-left w3-container w3-center w3-margin-top">
               <button disabled id="resetTable" class="w3-button w3-black w3-text-white" style="float: center;" onclick="resetTable();">Reset Table
           </div>  
      </div>

      <div class="w3-col m1 w3-center w3-margin-right w3-margin-left">
           <div class="w3-margin-left w3-container w3-center w3-margin-top">
               <button class="w3-button w3-black w3-text-white" style="float: center;" onclick="exit();">Exit
           </div>  
      </div>


</div>

</div>

      <div class="w3-col m12 w3-center w3-margin-left">
           <div id="salida"></div>
      </div>

<script>

function exit(){

  this.close()

}

function addPoint(){

   //     data.addRows(1); // Adiciona 1 row
   //     data.setCell(71, 0, 100);  // fila,columna,dato. Empieza en 0
   //     data.setCell(0,0,100);
   //     data.setCell(2, 1, 860);
   //     chart.draw(data,options);

  var previoushours = lasthours;
  var previousminutes = lastminutes;

  lasthours = parseInt(document.getElementById('hours').value);
  lastminutes =  parseInt(document.getElementById('minutes').value);
  lastpower =  parseInt(document.getElementById('power').value);
document.getElementById('salida').innerHTML ="Last: " + lasthours*60+lastminutes + "Prev: " + previoushours*60+previousminutes

  if (lasthours*60 + lastminutes <= previoushours*60+previousminutes) {
     // document.getElementById('salida').innerHTML ="Last time must be higher than the previous point";
     // Devuelvo los valores anteriores sino en la proxima vuelta lo hace mal
     lasthours = previoushours;
     lastminutes = previousminutes;
     }
  else {

     // En el punto anterior mas 1 seg pongo tambien esta potencia
        data.addRows([[[previoushours,previousminutes,1], lastpower]]);
     // Ahora veo la nueva hora y tambien le pongo esa power
        data.addRows([[[lasthours,lastminutes,0], lastpower]]);
        document.getElementById('salida').innerHTML ="Last point set: "+ lasthours + ":" + lastminutes +" Pwr: " + lastpower;
        data.addRows([[[lasthours,lastminutes,0], lastpower]]);
        michart.draw(data,options);
     }

}



function saveTable(){



}

function resetTable(){

data="";
data = new google.visualization.DataTable();

data.addColumn('timeofday', 'Time of Day');
data.addColumn('number', 'Light Power');

michart.draw(data,options);
lasthours=0;
lastminutes=0;
lastpower=0;

}

function tableselect(){

 selectedtable = document.getElementById('table').value;
 data="";
 data = new google.visualization.DataTable();
 data.addColumn('timeofday', 'Time of Day');
 data.addColumn('number', 'Light Power');

 document.getElementById("hours").disabled = true;
 document.getElementById("minutes").disabled = true;
 document.getElementById("power").disabled = true;
 document.getElementById("addPoint").disabled = true;
 document.getElementById("saveTable").disabled = true;
 document.getElementById("resetTable").disabled = true;

 switch (selectedtable){ 
   case '0':   
    document.getElementById("hours").disabled = false;
    document.getElementById("minutes").disabled = false;
    document.getElementById("power").disabled = false;
    document.getElementById("addPoint").disabled = false;
    document.getElementById("saveTable").disabled = false;
    document.getElementById("resetTable").disabled = false;


     break;
   case '1':   
     options.title= 'Table 1';
     data.addRows([
        [[0, 0, 0],50],
        [[6, 59, 0], 50],
        [[7, 0, 0], 25],
        [[7, 29, 0, 0], 25],
        [[7, 30, 0, 0], 0],
        [[19, 44, 59, 0], 0],
        [[19, 45, 0, 0], 30],
        [[19, 59, 0, 0], 30],        
        [[20, 0, 0, 0], 50],
        [[23, 59, 0], 50]
     ]);

     break;
   case '2': 
     options.title= 'Table 2';
     data.addRows([
        [[0, 0, 0],100],
        [[6, 59, 0], 100],
        [[7, 0, 0], 40],
        [[7, 29, 0, 0], 40],
        [[7, 30, 0, 0], 0],
        [[19, 44, 59, 0], 0],
        [[19, 45, 0, 0], 40],
        [[19, 59, 0, 0], 40],        
        [[20, 0, 0, 0], 100],
        [[23, 59, 0], 100]
     ]);
  

     break;
   case '3':  
     options.title= 'Table 3';
     data.addRows([
        [[0, 0, 0],100],
        [[8, 29, 0], 100],
        [[8, 30, 0], 0],
        [[19, 0, 0, 0], 0],
        [[19, 1, 0, 0], 100],
        [[23, 59, 0], 100]
     ]); 

     break;
   case '4':   

     break;
   default:
     break;

  }

michart.draw(data,options);
lasthours=0;
lastminutes=0;
lastpower=0;

}

</script>




<script>
google.charts.load('current', {'packages':['corechart']});
google.charts.setOnLoadCallback(drawChart);
var michart;
var lasthours=0;
var lastminutes=0;
var lastpower=0;
var data;
var selectedtable = ""

var options = {
        title: 'Control Table: SCH1',
        height: 450,
        width: 1200,
        hAxis: { title:"Time" ,gridlines: { count: 47, color:'LightGrey'}, textStyle: {color: 'black', fontSize:12}},
        vAxis: { ticks:[0,10,20,30,40,50,60,70,80,90,100], title:"Light Power %",gridlines: { count: 11, color:'LightGrey'}, textStyle: {color: 'black', fontSize:12}} 
        
};

function drawChart() {
      data = new google.visualization.DataTable();

      data.addColumn('timeofday', 'Time of Day');
      data.addColumn('number', 'Light Power');

/*
      data.addRows([
        [[0, 0, 0],100],
        [[6, 59, 0], 100],
        [[7, 0, 0], 40],
        [[7, 29, 0, 0], 40],
        [[7, 30, 0, 0], 0],
        [[19, 44, 59, 0], 0],
        [[19, 45, 0, 0], 40],
        [[19, 59, 0, 0], 40],        
        [[20, 0, 0, 0], 100],

        [[23, 59, 0], 100]
      ]);

*/
      // backgroundColor:{fill:'white'},
      // legend: { position: 'right',textStyle: {color: 'blue', fontSize:6} },  // Cartelito de Light Power


     
      var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
      michart=chart
      michart.draw(data, options);

}

</script>